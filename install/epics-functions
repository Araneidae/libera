# This file is part of the Libera EPICS Driver,
# Copyright (C) 2009 Michael Abbott, Diamond Light Source Ltd.
#
# The Libera EPICS Driver is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.
#
# The Libera EPICS Driver is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General
# Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc., 51
# Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
#
# Contact:
#      Dr. Michael Abbott,
#      Diamond Light Source Ltd,
#      Diamond House,
#      Chilton,
#      Didcot,
#      Oxfordshire,
#      OX11 0DE
#      michael.abbott@diamond.ac.uk

# This file contains common scripting functions that are intended to be
# installed on the target system.

Error()
{
    echo >&2 "$@"
    exit 1
}

# The following functions were defined in /etc/init.d/functions on Libera on
# linux 2.4, but don't seem to have equivalents in the more recent
# distribution, so we define what we need here.
evaluate_retval()
{
    if [ $? = 0 ]; then
        print_status success
    else
        print_status failure
    fi
}

: "${COLUMNS:=80}"      # Ensure COLUMNS is set
print_status()
{
    echo -n $'\033['"$((COLUMNS-10))G"
    echo -n [
    case "$1" in
        success)    echo -n $'\033[1;32m  OK  ' ;;
        failure)    echo -n $'\033[1;31mFAILED' ;;
    esac
    echo -n $'\033[0;39m'
    echo ]
}
